<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="nossl.sh helps you diagnose no SSL connection issues, check your Wi-Fi, verify internet access, troubleshoot captive portal login pages, and inspect the headers your device sends."
    />
    <meta
      name="keywords"
      content="no ssl, nossl, never ssl alternative, captive portal login, hotel wifi login, airport wifi, coffee shop wifi, http test page"
    />
    <meta property="og:title" content="nossl.sh - Connection &amp; Header Diagnostics" />
    <meta
            property="og:description"
            content="nossl.sh helps you diagnose no SSL connection issues, check your Wi-Fi, verify internet access, troubleshoot captive portal login pages, and inspect the headers your device sends."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://nossl.sh/" />
    <meta property="og:site_name" content="nossl.sh" />
    <meta property="og:image" content="/static/og-image.png" />
    <meta property="og:image:alt" content="Abstract teal and navy banner for nossl.sh" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="nossl.sh - Connection &amp; Header Diagnostics" />
    <meta
            name="twitter:description"
            content="nossl.sh helps you diagnose no SSL connection issues, check your Wi-Fi, verify internet access, troubleshoot captive portal login pages, and inspect the headers your device sends."
    />
    <meta name="twitter:image" content="/static/og-image.png" />
    <meta name="twitter:image:alt" content="Abstract teal and navy banner for nossl.sh" />
    <title>nossl.sh - Connection &amp; Header Diagnostics</title>
    <link rel="icon" href="/favicon.ico" type="image/svg+xml" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <header class="top-bar">
      <div class="container top-bar__inner">
        <div class="branding" role="banner">
          <span class="logo" aria-hidden="true">●</span>
          <div class="branding__copy">
            <span class="brand-name">nossl.sh</span>
            <span class="brand-status">You're online</span>
          </div>
        </div>
        <p class="top-bar__hint">Plain HTTP diagnostics for captive portals &amp; restricted networks</p>
      </div>
    </header>

    <main class="container dashboard">
      <section aria-labelledby="connection-info" class="panel panel--connection">
        <header class="panel__header">
          <h2 id="connection-info">Connection snapshot</h2>
          <span class="status <%= scheme === 'https' ? 'secure' : 'insecure' %>">
            <%= status %>
          </span>
        </header>

        <p class="panel__summary">
          Request served over <strong><%= scheme.toUpperCase() %></strong>. These numbers refresh each time you load the page.
        </p>

        <dl class="connection-grid">
          <div>
            <dt>Connection type</dt>
            <dd><%= scheme.toUpperCase() %></dd>
          </div>
          <div>
            <dt>Client IP</dt>
            <dd class="mono"><%= clientIp %></dd>
          </div>
          <div>
            <dt>Page timestamp</dt>
            <dd class="mono"><%= generatedAt.toISOString().replace('T', ' ').replace(/\..+/, ' UTC') %></dd>
          </div>
          <div>
            <dt>Ping time</dt>
            <dd class="mono" data-api-latency aria-live="polite">Measuring…</dd>
          </div>
        </dl>

        <div class="connection-tools">
          <button type="button" class="widget widget--headers" data-open-headers>
            Request headers JSON
          </button>

          <div class="curl-card">
            <h3>cURL checks</h3>
            <p class="curl-card__summary">
              The plain curl command below only shows your IP in the HTML response. Use the API variant for a JSON payload with
              the same connection snapshot.
            </p>
            <div class="curl-snippets">
              <div class="code-snippet">
                <button
                  type="button"
                  class="copy copy--snippet"
                  data-copy-target="curl-http"
                  aria-label="Copy curl command for homepage"
                >
                  Copy
                </button>
                <pre><code id="curl-http">curl http://nossl.sh</code></pre>
              </div>
              <div class="code-snippet">
                <button
                  type="button"
                  class="copy copy--snippet"
                  data-copy-target="curl-api"
                  aria-label="Copy curl command for API request"
                >
                  Copy
                </button>
                <pre><code id="curl-api">curl -H "Accept: application/json" http://nossl.sh/api/request-info</code></pre>
              </div>
            </div>
          </div>
        </div>
      </section>

      <div class="modal" data-headers-modal hidden aria-hidden="true">
        <div class="modal__backdrop" data-close-headers></div>
        <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="headers-modal-title">
          <header class="modal__header">
            <div>
              <h3 id="headers-modal-title">Request headers JSON</h3>
              <p class="modal__summary">Exact headers we observed when you loaded this page.</p>
            </div>
            <div class="modal__actions">
              <button type="button" class="copy" data-copy-headers>Copy JSON</button>
              <button type="button" class="modal__close" data-close-headers aria-label="Close headers modal">✕</button>
            </div>
          </header>
          <pre class="modal__content"><code class="mono" data-headers-json></code></pre>
        </div>
      </div>

      <section aria-labelledby="ascii-banner" class="panel panel--ascii">
        <header class="panel__header">
          <h2 id="ascii-banner">http://nossl.sh</h2>
        </header>
        <div class="ascii-wrapper" role="img" aria-label="http://nossl.sh rendered in ASCII art">
          <pre class="ascii-art">
 __  __ ______ _______ _____   _____ _     _     _____ _    _
|  \/  ||  _  \|_   _|/  ___| /  ___| |   (_)   /  ___| |  | |
| .  . || | | |  | |  \ `--.  \ `--.| |__  _ _ _ \ `--.| |__| |
| |\/| || | | |  | |   `--. \  `--. \ '_ \| | '_ \ `--. \  __  |
| |  | || |/ /  _| |_ /\__/ / /\__/ / | | | | | | /\__/ / |  | |
\_|  |_/|___/   \___/ \____/  \____/|_| |_|_|_|  \____/ \_|  |_|
          </pre>
        </div>
      </section>

      <section aria-labelledby="usage-information" class="panel panel--support">
        <header class="panel__header">
          <h2 id="usage-information">Why this page exists</h2>
        </header>
        <div class="panel__body">
          <p>
            Inspired by NeverSSL, nossl.sh is a quick diagnostic checkpoint when captive portals or restrictive firewalls block
            HTTPS handshakes. Load this page to trigger splash screens and inspect what your device sends.
          </p>
          <p>
            Still stuck? Confirm your Wi-Fi link, temporarily disable VPNs, or retry after clearing custom DNS profiles.
          </p>
          <p>
            Keep this URL handy for smart TVs, consoles, or travel routers that need an HTTP-only landing page to finish login
            flows.
          </p>
        </div>
      </section>
    </main>

    <footer>
      <div class="container">
        <p>Page generated at <%= generatedAt.toISOString().replace('T', ' ').replace(/\..+/, ' UTC') %>.</p>
        <p>
          Prefer JSON? Try the
          <a href="/api/request-info" rel="nofollow">request info API endpoint</a>.
        </p>
      </div>
    </footer>
    <script>
      const latencyEl = document.querySelector('[data-api-latency]');
      const headersModal = document.querySelector('[data-headers-modal]');
      const headersOpenButton = document.querySelector('[data-open-headers]');
      const headersCloseButtons = document.querySelectorAll('[data-close-headers]');
      const headersCopyButton = headersModal?.querySelector('[data-copy-headers]');
      const headersContent = headersModal?.querySelector('[data-headers-json]');
      const copyCommandButtons = document.querySelectorAll('[data-copy-target]');
      const headerPairs = <%- JSON.stringify(headers) %>;
      const headersPayload = headerPairs.reduce((acc, [key, value]) => {
        if (acc[key]) {
          acc[key] = Array.isArray(acc[key]) ? [...acc[key], value] : [acc[key], value];
        } else {
          acc[key] = value;
        }
        return acc;
      }, {});

      if (latencyEl) {
        const startedAt = performance.now();
        fetch('/api/request-info', { headers: { Accept: 'application/json' } })
          .then((response) => {
            const elapsed = Math.round(performance.now() - startedAt);
            latencyEl.textContent = `${elapsed} ms`;

            if (!response.ok) {
              throw new Error('Response not OK');
            }
          })
          .catch(() => {
            latencyEl.textContent = 'Unable to measure';
          });
      }

      const fallbackCopyText = (text) => {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'absolute';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);

        const selection = window.getSelection();
        if (selection && selection.rangeCount) {
          selection.removeAllRanges();
        }

        textarea.select();

        let successful = false;
        try {
          successful = document.execCommand('copy');
        } catch (error) {
          successful = false;
        }

        document.body.removeChild(textarea);
        return successful;
      };

      const copyText = async (text) => {
        if (navigator.clipboard && typeof navigator.clipboard.writeText === 'function') {
          try {
            await navigator.clipboard.writeText(text);
            return true;
          } catch (error) {
            // fall back to execCommand
          }
        }

        return fallbackCopyText(text);
      };

      if (headersContent) {
        headersContent.textContent = JSON.stringify(headersPayload, null, 2);
      }

      if (headersCopyButton) {
        headersCopyButton.addEventListener('click', async () => {
          const copied = await copyText(JSON.stringify(headersPayload, null, 2));
          headersCopyButton.textContent = copied ? 'Copied!' : 'Copy failed';
          setTimeout(() => {
            headersCopyButton.textContent = 'Copy JSON';
          }, 2000);
        });
      }

      let lastFocusedElement = null;

      const closeHeadersModal = () => {
        if (!headersModal) return;
        headersModal.hidden = true;
        headersModal.setAttribute('aria-hidden', 'true');
        document.body.style.removeProperty('overflow');
        if (lastFocusedElement && typeof lastFocusedElement.focus === 'function') {
          lastFocusedElement.focus();
        }
      };

      const openHeadersModal = () => {
        if (!headersModal) return;
        lastFocusedElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;
        headersModal.hidden = false;
        headersModal.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
        headersCopyButton?.focus();
      };

      if (headersOpenButton) {
        headersOpenButton.addEventListener('click', openHeadersModal);
      }

      headersCloseButtons.forEach((button) => {
        button.addEventListener('click', closeHeadersModal);
      });

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && !headersModal?.hidden) {
          event.preventDefault();
          closeHeadersModal();
        }
      });

      if (headersModal) {
        headersModal.addEventListener('click', (event) => {
          if (event.target === headersModal) {
            closeHeadersModal();
          }
        });
      }

      copyCommandButtons.forEach((button) => {
        const targetId = button.getAttribute('data-copy-target');
        if (!targetId) {
          return;
        }

        const target = document.getElementById(targetId);
        if (!target) {
          return;
        }

        const defaultLabel = button.textContent?.trim() || 'Copy';

        button.addEventListener('click', async () => {
          const commandText = target.textContent ? target.textContent.trim() : '';
          const copied = await copyText(commandText);
          button.textContent = copied ? 'Copied!' : 'Copy failed';
          setTimeout(() => {
            button.textContent = defaultLabel;
          }, 2000);
        });
      });
    </script>
  </body>
</html>

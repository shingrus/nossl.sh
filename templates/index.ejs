<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="nossl.sh helps you diagnose no SSL connection issues, check your Wi-Fi, verify internet access, troubleshoot captive portal login pages, and inspect the headers your device sends."
    />
    <meta
      name="keywords"
      content="no ssl, nossl, never ssl alternative, captive portal login, hotel wifi login, airport wifi, coffee shop wifi, http test page"
    />
    <meta property="og:title" content="nossl.sh - Connection &amp; Header Diagnostics" />
    <meta
            property="og:description"
            content="nossl.sh helps you diagnose no SSL connection issues, check your Wi-Fi, verify internet access, troubleshoot captive portal login pages, and inspect the headers your device sends."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://nossl.sh/" />
    <meta property="og:site_name" content="nossl.sh" />
    <meta property="og:image" content="/static/og-image.png" />
    <meta property="og:image:alt" content="Abstract teal and navy banner for nossl.sh" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="nossl.sh - Connection &amp; Header Diagnostics" />
    <meta
            name="twitter:description"
            content="nossl.sh helps you diagnose no SSL connection issues, check your Wi-Fi, verify internet access, troubleshoot captive portal login pages, and inspect the headers your device sends."
    />
    <meta name="twitter:image" content="/static/og-image.png" />
    <meta name="twitter:image:alt" content="Abstract teal and navy banner for nossl.sh" />
    <title>nossl.sh - Connection &amp; Header Diagnostics</title>
    <link rel="icon" href="/favicon.ico" type="image/svg+xml" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="container topbar__layout">
        <div class="brand" aria-label="nossl.sh">
          <span class="brand__mark" aria-hidden="true">◎</span>
          <div class="brand__copy">
            <span class="brand__name">nossl.sh</span>
            <span class="brand__status">You're online</span>
          </div>
        </div>
        <div class="connection-pill <%= scheme === 'https' ? 'is-https' : 'is-http' %>">
          <span class="connection-pill__label">Connection</span>
          <span class="connection-pill__value"><%= scheme.toUpperCase() %></span>
        </div>
      </div>
    </header>

    <main class="container main-content">
      <section class="insights" aria-labelledby="connection-insights">
        <div class="section-heading">
          <h2 id="connection-insights">Live connection snapshot</h2>
          <p class="section-heading__copy">Fast facts about the request your device just made.</p>
        </div>
        <dl class="insights__grid">
          <div>
            <dt>Connection type</dt>
            <dd class="insights__value"><%= scheme.toUpperCase() %></dd>
          </div>
          <div>
            <dt>IP address</dt>
            <dd class="insights__value insights__value--mono"><%= clientIp %></dd>
          </div>
          <div>
            <dt>Page timestamp</dt>
            <dd class="insights__value insights__value--mono"><%= generatedAt.toISOString().replace('T', ' ').replace(/\..+/, ' UTC') %></dd>
          </div>
          <div>
            <dt>Ping time</dt>
            <dd class="insights__value insights__value--mono" data-api-latency aria-live="polite">Measuring…</dd>
          </div>
        </dl>
      </section>

      <section aria-labelledby="request-headers" class="request-headers">
        <div class="section-heading">
          <h2 id="request-headers">Request headers</h2>
          <div class="section-heading__actions">
            <button type="button" class="copy-json" data-copy-headers>Copy JSON</button>
          </div>
        </div>
        <p class="section-description">A compact view of the headers we received from your device.</p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th scope="col">Header</th>
                <th scope="col">Value</th>
              </tr>
            </thead>
            <tbody>
              <% headers.forEach(([key, value]) => { %>
              <tr>
                <th scope="row"><%= key %></th>
                <td><%= value %></td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </section>

      <section class="usage-grid" aria-labelledby="how-to">
        <div class="usage-card" id="how-to">
          <div class="section-heading">
            <h2>How to use nossl.sh</h2>
          </div>
          <p>Run a quick HTTP check from any shell to confirm the network allows unsecured traffic:</p>
          <pre><code>curl http://nossl.sh</code></pre>
          <p>You'll get the same diagnostic data shown here in your terminal.</p>
        </div>
        <div class="usage-card" id="why">
          <div class="section-heading">
            <h2>Why this page exists</h2>
          </div>
          <p>
            Captive portals often unblock HTTP-only traffic first. Loading nossl.sh helps force their login screen to appear so you
            can authenticate and get back online quickly.
          </p>
          <p>
            Keep this tab handy—we plan to surface GeoIP insights, connection speed, and other quick checks right beside the core
            diagnostics.
          </p>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        <p>Page generated at <%= generatedAt.toISOString().replace('T', ' ').replace(/\..+/, ' UTC') %>.</p>
        <p>
          Prefer JSON? Try the <a href="/api/request-info" rel="nofollow">request info API endpoint</a>.
        </p>
      </div>
    </footer>
    <script>
      const latencyEl = document.querySelector('[data-api-latency]');
      const copyButton = document.querySelector('[data-copy-headers]');
      const headersData = <%- JSON.stringify(Object.fromEntries(headers)) %>;

      if (latencyEl) {
        const startedAt = performance.now();
        fetch('/api/request-info', { headers: { Accept: 'application/json' } })
          .then((response) => {
            const elapsed = Math.round(performance.now() - startedAt);
            latencyEl.textContent = `${elapsed} ms`;

            if (!response.ok) {
              throw new Error('Response not OK');
            }
          })
          .catch(() => {
            latencyEl.textContent = 'Unable to measure';
          });
      }

      if (copyButton) {
        copyButton.addEventListener('click', async () => {
          const formatted = JSON.stringify(headersData, null, 2);

          try {
            await navigator.clipboard.writeText(formatted);
            copyButton.textContent = 'Copied!';
            copyButton.setAttribute('aria-live', 'polite');
            setTimeout(() => {
              copyButton.textContent = 'Copy JSON';
              copyButton.removeAttribute('aria-live');
            }, 2400);
          } catch (error) {
            const temp = document.createElement('textarea');
            temp.value = formatted;
            temp.setAttribute('readonly', '');
            temp.style.position = 'absolute';
            temp.style.left = '-9999px';
            document.body.appendChild(temp);
            temp.select();
            document.execCommand('copy');
            document.body.removeChild(temp);
            copyButton.textContent = 'Copied!';
            setTimeout(() => {
              copyButton.textContent = 'Copy JSON';
            }, 2400);
          }
        });
      }
    </script>
  </body>
</html>

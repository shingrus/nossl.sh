<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="nossl.sh helps you diagnose no SSL connection issues, check your Wi-Fi, verify internet access, troubleshoot captive portal login pages, and inspect the headers your device sends."
    />
    <meta
      name="keywords"
      content="no ssl, nossl, never ssl alternative, captive portal login, hotel wifi login, airport wifi, coffee shop wifi, http test page"
    />
    <meta property="og:title" content="nossl.sh - Connection &amp; Header Diagnostics" />
    <meta
            property="og:description"
            content="nossl.sh helps you diagnose no SSL connection issues, check your Wi-Fi, verify internet access, troubleshoot captive portal login pages, and inspect the headers your device sends."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://nossl.sh/" />
    <meta property="og:site_name" content="nossl.sh" />
    <meta property="og:image" content="/static/og-image.png" />
    <meta property="og:image:alt" content="Abstract teal and navy banner for nossl.sh" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="nossl.sh - Connection &amp; Header Diagnostics" />
    <meta
            name="twitter:description"
            content="nossl.sh helps you diagnose no SSL connection issues, check your Wi-Fi, verify internet access, troubleshoot captive portal login pages, and inspect the headers your device sends."
    />
    <meta name="twitter:image" content="/static/og-image.png" />
    <meta name="twitter:image:alt" content="Abstract teal and navy banner for nossl.sh" />
    <title>nossl.sh - Connection &amp; Header Diagnostics</title>
    <link rel="icon" href="/favicon.ico" type="image/svg+xml" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <% const headerMap = Object.fromEntries(headers); %>
    <% const hostHeader = headerMap['host'] || '—'; %>
    <% const userAgent = headerMap['user-agent'] || '—'; %>
    <% const acceptLanguage = headerMap['accept-language'] || '—'; %>
    <% const forwardedFor = headerMap['x-forwarded-for']; %>

    <header class="top-bar">
      <div class="top-bar__content container">
        <div class="brand">
          <img src="/static/logo.svg" width="40" height="40" alt="nossl.sh logo" class="brand__logo" />
          <div class="brand__text">
            <span class="brand__name">nossl.sh</span>
            <span class="brand__status"><span class="brand__dot" aria-hidden="true"></span>You're online</span>
          </div>
        </div>
        <div class="top-bar__status">
          <span class="status-code"><%= status %></span>
          <span class="status-pill <%= scheme === 'https' ? 'status-pill--secure' : 'status-pill--insecure' %>">
            <%= scheme.toUpperCase() %>
          </span>
        </div>
      </div>
    </header>

    <main class="dashboard container">
      <section aria-labelledby="snapshot" class="panel panel--cards">
        <div class="panel__header">
          <h2 id="snapshot">Connection snapshot</h2>
          <p class="panel__hint">Key facts about the request you just made.</p>
        </div>
        <div class="cards-grid">
          <article class="card">
            <h3>Protocol</h3>
            <p class="card__value card__value--strong"><%= scheme.toUpperCase() %></p>
            <p class="card__meta">HTTP vs HTTPS detection.</p>
          </article>
          <article class="card">
            <h3>IP address</h3>
            <p class="card__value card__value--mono" title="Client IP"><%= clientIp %></p>
            <p class="card__meta">How we see your connection.</p>
          </article>
          <article class="card">
            <h3>Page timestamp</h3>
            <p class="card__value card__value--mono">
              <%= generatedAt.toISOString().replace('T', ' ').replace(/\..+/, ' UTC') %>
            </p>
            <p class="card__meta">Snapshot of when this view was generated.</p>
          </article>
          <article class="card">
            <h3>Ping</h3>
            <p class="card__value" data-api-latency aria-live="polite">Measuring…</p>
            <p class="card__meta">Round-trip time to the request info API.</p>
          </article>
          <article class="card">
            <h3>Host header</h3>
            <p class="card__value card__value--mono" title="<%= hostHeader %>"><%= hostHeader %></p>
            <p class="card__meta">What your client requested.</p>
          </article>
          <article class="card">
            <h3>Accept-Language</h3>
            <p class="card__value card__value--wrap" title="<%= acceptLanguage %>"><%= acceptLanguage %></p>
            <p class="card__meta">Language preferences supplied.</p>
          </article>
          <% if (forwardedFor) { %>
          <article class="card">
            <h3>X-Forwarded-For</h3>
            <p class="card__value card__value--wrap" title="<%= forwardedFor %>"><%= forwardedFor %></p>
            <p class="card__meta">Upstream client IP chain.</p>
          </article>
          <% } %>
          <article class="card card--wide">
            <h3>User-Agent</h3>
            <p class="card__value card__value--wrap" title="<%= userAgent %>"><%= userAgent %></p>
            <p class="card__meta">Device + browser details.</p>
          </article>
        </div>
      </section>

      <section aria-labelledby="request-headers" class="panel request-headers">
        <div class="panel__header">
          <h2 id="request-headers">Request headers</h2>
          <button type="button" class="copy-button" data-copy-source="headers-json">Copy JSON</button>
        </div>
        <p class="panel__hint">Full header list for debugging captive portals or proxy settings.</p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th scope="col">Header</th>
                <th scope="col">Value</th>
              </tr>
            </thead>
            <tbody>
              <% headers.forEach(([key, value]) => { %>
              <tr>
                <th scope="row"><%= key %></th>
                <td><%= value %></td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </section>

      <section aria-labelledby="how-to" class="panel usage">
        <div class="panel__header">
          <h2 id="how-to">Quick usage</h2>
        </div>
        <p>
          Run a fast <code>curl</code> request to confirm that your device can reach the open
          <strong>http://nossl.sh</strong> landing page:
        </p>
        <pre><code>curl http://nossl.sh</code></pre>
        <p>
          Keep this page in mind for future upgrades&mdash;we plan to surface GeoIP, connection speed, and
          more actionable diagnostics alongside the data above.
        </p>
      </section>

      <section aria-labelledby="usage-information" class="panel usage-info">
        <div class="panel__header">
          <h2 id="usage-information">Why nossl.sh matters</h2>
        </div>
        <p>
          nossl.sh is a lightweight, SSL-free checkpoint inspired by NeverSSL. It's built for captive
          portal troubleshooting, Wi-Fi splash screens that refuse to appear, and environments where encrypted
          traffic is blocked.
        </p>
        <p>
          If the page doesn't load at all, double-check your Wi-Fi, verify that your internet service is up,
          and try temporarily disabling VPNs or custom DNS settings.
        </p>
        <p>
          Keep the URL handy for smart TVs, consoles, streaming boxes, or any device that struggles with
          HTTPS handshakes on restricted networks.
        </p>
      </section>
    </main>

    <footer>
      <div class="container">
        <p>Page generated at <%= generatedAt.toISOString().replace('T', ' ').replace(/\..+/, ' UTC') %>.</p>
        <p>
          Prefer JSON? Try the
          <a href="/api/request-info" rel="nofollow">request info API endpoint</a>.
        </p>
      </div>
    </footer>

    <script type="application/json" id="headers-json"><%- JSON.stringify(headerMap, null, 2) %></script>
    <script>
      const latencyEl = document.querySelector('[data-api-latency]');

      if (latencyEl) {
        const startedAt = performance.now();
        fetch('/api/request-info', { headers: { Accept: 'application/json' } })
          .then((response) => {
            const elapsed = Math.round(performance.now() - startedAt);
            latencyEl.textContent = `${elapsed} ms`;

            if (!response.ok) {
              throw new Error('Response not OK');
            }
          })
          .catch(() => {
            latencyEl.textContent = 'Unable to measure';
          });
      }

      const copyButton = document.querySelector('[data-copy-source]');

      if (copyButton) {
        const sourceId = copyButton.getAttribute('data-copy-source');
        const sourceEl = document.getElementById(sourceId);

        copyButton.addEventListener('click', async () => {
          if (!sourceEl) {
            return;
          }

          try {
            await navigator.clipboard.writeText(sourceEl.textContent.trim());
            const previousLabel = copyButton.textContent;
            copyButton.textContent = 'Copied!';
            copyButton.classList.add('copy-button--success');
            setTimeout(() => {
              copyButton.textContent = previousLabel;
              copyButton.classList.remove('copy-button--success');
            }, 2000);
          } catch (error) {
            copyButton.textContent = 'Copy failed';
            copyButton.classList.add('copy-button--error');
            setTimeout(() => {
              copyButton.textContent = 'Copy JSON';
              copyButton.classList.remove('copy-button--error');
            }, 2500);
          }
        });
      }
    </script>
  </body>
</html>
